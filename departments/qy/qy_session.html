<!DOCTYPE html>
 <html lang="zh-CN">
 <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前研探索部</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .header-bar {
            font-size: 22px;
            background-color: #33333300;
            color: white;
            padding: 10px 0;
        }
        .header-bar a {
            color: rgb(0, 0, 0);
            margin: 0 15px;
            text-decoration: none;
            display:inline-block;
            border: 1px solid black;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .lflink {
            float: left;
            margin-left: 20px;
        }
        .rtlink {
            float: right;
            margin-right: 20px;
         }
        .header-bar a:hover {
            background-color: rgba(128, 128, 128, 0.2);
        }
        .card-container {
            bottom: 0;
            width: 100%;
            height: 60vh;
            perspective: 1000px;
        }
        .card {
            transform: 
                translateX(-50%)
                scale(var(--cardScale, 1))
                rotateY(var(--cardRotateY, 0deg))
                rotateX(var(--rotateX,0deg))
                rotateY(var(--rotateY,0deg)); /* 重新添加 rotateX 和 rotateY */
            position: absolute;
            width: 175px;
            height: 50%;
            bottom: -10%;
            background-color: transparent;
            border-radius: 10%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
            transform-style: preserve-3d;
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10%;
        }

        .card-face.front { /* 保持这个类名不变 */
            transform: rotateY(0deg);
        }

        .card-face.back { /* 保持这个类名不变 */
            transform: rotateY(180deg);
        }

        /* 当卡片被翻转时，同时应用翻转效果和重置鼠标效果 */
        .card.flipped {
            transform: 
                translateX(-50%) 
                scale(var(--cardScale, 1)) 
                rotateY(var(--cardRotateY, 0deg))
                rotateY(180deg); /* 仅用 rotateY(180deg) 即可实现翻转效果 */
        }

        /* 翻转后，正面和背面都保持静止，不再受鼠标影响 */
        .card.flipped .card-face.front {
            transform: rotateY(180deg);
        }
        .card.flipped .card-face.back {
            transform: rotateY(180deg);
        }
        .card.active {
            opacity: 1;
        }
        .card.center {
            left: 50%;
            z-index: 3;
            pointer-events: all;
            --cardScale: 2;
            --cardRotateY: 0deg;
        }
        .card.left {
            left: 25%;
            z-index: 2;
            --cardScale: 1.6;
            --cardRotateY: -45deg;
        }
        .card.right {
            left: 75%;
            z-index: 2;
            --cardScale: 1.6;
            --cardRotateY: 45deg;
        }
        .card.hide-left {
            left: 10%;
            z-index: 1;
            --cardScale: 1;
            --cardRotateY: -70deg;
        }
        .card.hide-right {
            left: 90%;
            z-index: 1;
            --cardScale: 1;
            --cardRotateY: 70deg;
        }
        .card.flipped {
            transform: 
              translateX(-50%) 
              scale(var(--cardScale, 1)) 
              rotateY(var(--cardRotateY, 0deg))
              rotateX(var(--rotateX, 0deg)) 
              rotateY(calc(180deg + var(--rotateY, 0deg)));
        }
        .controls {
            position: fixed;
            bottom: 40%;
            border-color: rgba(0,0,0,0);
            width: 100%;
        }
        .controls button {
            background-color: #f4f4f4;
            color: black;
            border: none;
            cursor: pointer;
            font-size: 120px;
        }
        .controls button:hover {
            color:grey;
        }
        #prevBtn {
            float: left;
            margin-left: 20px;
        }
        #nextBtn {
            float: right;
            margin-right: 20px;
        }
        .line-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* 确保线条不会阻碍其他元素的交互 */
        }
        .V-line-A {
            position: absolute;
            top: 0;
            left: 35%;
            width: 2px;
            height: 30%;
            background-color: rgba(0, 0, 0, 0.7);
            transform: translateX(-50%);
        }
        .V-line-B {
            position: absolute;
            bottom: 0;
            left: 35%;
            width: 2px;
            height: 55%;
            background-color: rgba(0, 0, 0, 0.7);
            transform: translateX(-50%);
        }
        .H-line {
            position: absolute;
            top: 70%;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: rgba(0, 0, 0, 0.1);
            transform: translateY(-50%);
        }
        .word-container {
            position: fixed;
            bottom: 70%;
            right: 66%;
            width: 90%;
            text-align: right;
            font-size: 18px;
            color: rgba(0, 0, 0, 0.7);
        }
      </style>
 </head>
 <body>
    <header class="header-bar">
    <!-- 扩散绿色色块背景层 -->
    <div id="green-bg" style="position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:-2;pointer-events:none;overflow:hidden;"></div>
    <div id="lightgreen-bg" style="position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:-1;pointer-events:none;overflow:hidden;"></div>
      <div class="lflink">
        <a href="../../index.html",class="backset">返回主页</a>
        <a href="#" id="btn-dep-intro">部门介绍</a>
      </div>
      <div class="rtlink">
        <a href="#">历届部门</a>
        <a href="">部门活动</a>
        <a href="">日志</a>
      </div> 
    </header>
    <div class="card-container">
        <div class="card active center">
          <div class="card-face front">
            <img src="../../image/session-1.png" alt="Card Image" style="width:100%; height:100%; border-radius:10%;">
          </div>
                    <div class="card-face back">
                        <!-- <a href="" style="display: block; width: 100%; height: 100%;"> -->
                        <div style="display: block; width: 100%; height: 100%;">
                            <img src="../../image/session-1-b.png" alt="Card Back Image" style="width:100%; height:100%; border-radius:10%;">
                        </div>
                        <!-- </a> -->
          </div>
        </div>
        <div class="card active left">
          <div class="card-face front">
            <img src="../../image/session-2.png" alt="Card Image" style="width:100%; height:100%; border-radius:10%;">
          </div>
                    <div class="card-face back">
                        <!-- <a href="" style="display: block; width: 100%; height: 100%;"> -->
                        <div style="display: block; width: 100%; height: 100%;">
                            <img src="../../image/session-2-b.png" alt="Card Back Image" style="width:100%; height:100%; border-radius:10%;">
                        </div>
                        <!-- </a> -->
          </div>
        </div>
        <div class="card active right">
          <div class="card-face front">
            <img src="../../image/session-3.png" alt="Card Image" style="width:100%; height:100%; border-radius:10%;">
          </div>
                    <div class="card-face back">
                        <!-- <a href="" style="display: block; width: 100%; height: 100%;"> -->
                        <div style="display: block; width: 100%; height: 100%;">
                            <img src="../../image/session-3-b.png" alt="Card Back Image" style="width:100%; height:100%; border-radius:10%;">
                        </div>
                        <!-- </a> -->
          </div>
        </div>
        <div class="card hide-left">
          <div class="card-face front">
            <img src="../../image/session-4.png" alt="Card Image" style="width:100%; height:100%; border-radius:10%;">
          </div>
                    <div class="card-face back">
                        <!-- <a href="#" style="display: block; width: 100%; height: 100%;"> -->
                        <div style="display: block; width: 100%; height: 100%;">
                            <img src="../../image/session-4-b.png" alt="Card Back Image" style="width:100%; height:100%; border-radius:10%;">
                        </div>
                        <!-- </a> -->
          </div>
        </div>
        <div class="card hide-right">
          <div class="card-face front">
            <img src="../../image/session-5.png" alt="Card Image" style="width:100%; height:100%; border-radius:10%;">
          </div>
                    <div class="card-face back">
                        <!-- <a href="" style="display: block; width: 100%; height: 100%;"> -->
                        <div style="display: block; width: 100%; height: 100%;">
                            <img src="../../image/session-5-b.png" alt="Card Back Image" style="width:100%; height:100%; border-radius:10%;">
                        </div>
                        <!-- </a> -->
          </div>
        </div>
    </div>   
    <div class="controls">
        <button id="prevBtn">
            <i class="fas fa-angle-left"></i>
        </button>
        <button id="nextBtn">
            <i class="fas fa-angle-right"></i>
        </button>
    </div>

    <!-- 界面美化 -->
    <div class="line-container">
        <div class="V-line-A"> </div>
        <div class="V-line-B"> </div>
        <div class="H-line"> </div>
    </div>

    <!-- 用户提示 -->
    <h2 class="flash-title">点击下方卡片，将其翻转</h2>
    <div id="flip-tip" class="flip-tip" style="display:none;"></div>
    <style>
    .flash-title {
        position: fixed;
        top: 8vh;
        left: 50%;
        transform: translateX(-50%);
        font-size: 2.2rem;
        color: #111;
        font-weight: bold;
        letter-spacing: 2px;
        text-align: center;
        z-index: 10;
        animation: flash 1.2s linear infinite alternate;
        text-shadow: 0 0 8px #b6f7c200, 0 0 16px #3ecf5e00;
    }
    .flip-tip {
        position: fixed;
        left: 50%;
        top: calc(68vh + 200px);
        transform: translateX(-50%);
        font-size: 1.6rem;
        font-weight: bold;
        color: #9b00b3;
        text-align: center;
        z-index: 20;
        letter-spacing: 1.5px;
        user-select: none;
        pointer-events: none;
        transition: opacity 0.3s;
        animation: flash 1.2s linear infinite alternate;
    }
    @keyframes flash {
        0% { opacity: 1; }
        100% { opacity: 0.3; }
    }
    </style>


    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll('.rtlink a').forEach(a => {
                if (a.textContent.includes('部门活动')) {
                    a.addEventListener('click', function(e) {
                        e.preventDefault();
                        window.location.href = 'department_activities.html';
                    });
                }
                if (a.textContent.includes('历届部门')) {
                    a.addEventListener('click', function(e) {
                        e.preventDefault();
                        window.location.href = 'qy_session.html';
                    });
                }});
            const cards = document.querySelectorAll(".card");
            const totalCards = cards.length;
            let currentIndex = 0;

            const prevBtn = document.getElementById("prevBtn");
            const nextBtn = document.getElementById("nextBtn");

            function showCard(index){
                cards.forEach((card, i) => {
                    card.classList.remove("active", "left", "right", "center", "hide-left", "hide-right");
                    if(i === index){
                        card.classList.add("active", "center");
                    } else if(i === (index - 1 + totalCards) % totalCards){
                        card.classList.add("active", "left");
                    } else if(i === (index + 1) % totalCards){
                        card.classList.add("active", "right");
                    } else if(i === (index - 2 + totalCards) % totalCards){
                        card.classList.add("hide-left");
                    } else if(i === (index + 2) % totalCards){
                        card.classList.add("hide-right");
                    } else {
                        card.classList.remove("active");
                    }
                });
            }
            prevBtn.addEventListener("click", function(){
                currentIndex = (currentIndex - 1 + totalCards) % totalCards;
                showCard(currentIndex);
            });
            nextBtn.addEventListener("click", function(){
                currentIndex = (currentIndex + 1) % totalCards;
                showCard(currentIndex);
            });
            showCard(currentIndex);

            const angle = 40;
            document.addEventListener("mousemove", (e) => {
                const centerCard = document.querySelector('.card.center');
                if (!centerCard || centerCard.classList.contains('flipped')) {
                    return; // 如果不是中心卡片或卡片已翻转，则不做任何事
                }

                const rect = centerCard.getBoundingClientRect();
                const cardWidth = rect.width;
                const cardHeight = rect.height;
                const centerX = rect.left + cardWidth / 2;
                const centerY = rect.top + cardHeight / 2;
                const mouseX = e.clientX - centerX;
                const mouseY = e.clientY - centerY;
                
                // 检查鼠标是否在卡片范围内
                if (mouseX >= -cardWidth/2 && mouseX <= cardWidth/2 && 
                    mouseY >= -cardHeight/2 && mouseY <= cardHeight/2) {
                    const rotateX = -(angle * mouseY) / (cardHeight / 2);
                    const rotateY = (angle * mouseX) / (cardWidth / 2);
                    
                    // 将效果应用到中心卡片上
                    centerCard.style.setProperty("--rotateX", rotateX + "deg");
                    centerCard.style.setProperty("--rotateY", rotateY + "deg");
                } else {
                    // 鼠标离开时恢复
                    centerCard.style.setProperty("--rotateX", "0deg");
                    centerCard.style.setProperty("--rotateY", "0deg");
                }
            });


            // 通用扩散动画函数，支持绿色/蓝色
            function playSessionExpand(centerCard, session) {
                const greenBg = document.getElementById('green-bg');
                const lightgreenBg = document.getElementById('lightgreen-bg');
                // 清空旧内容
                greenBg.innerHTML = '';
                lightgreenBg.innerHTML = '';
                // 获取卡片中心点
                const rect = centerCard.getBoundingClientRect();
                const cx = rect.left + rect.width/2;
                const cy = rect.top + rect.height/2;
                // 颜色配置
                let ringColor, ringGrad, circleColor, circleGrad;
                if (session === "2023") {
                    // 绿色
                    ringColor = 'rgba(62,207,94,0.7)';
                    ringGrad = 'linear-gradient(135deg,#3ecf5e 0%,#2e8b57 100%)';
                    circleColor = 'radial-gradient(circle, #e6faee 80%, #a2e6b8 100%)';
                    circleGrad = 'linear-gradient(135deg,#b6f7c2 20%,#a2e6b8 100%)';
                } else if (session === "2024") {
                    // 蓝色
                    ringColor = 'rgba(62,143,207,0.7)';
                    ringGrad = 'linear-gradient(135deg,#3e8fcf 0%,#2e5d8b 100%)';
                    circleColor = 'radial-gradient(circle, #e6f3fa 80%, #a2c6e6 100%)';
                    circleGrad = 'linear-gradient(135deg,#b6d7f7 20%,#a2c6e6 100%)';
                } else {
                    // 默认灰色
                    ringColor = 'rgba(180,180,180,0.5)';
                    ringGrad = 'linear-gradient(135deg,#eee 0%,#bbb 100%)';
                    circleColor = 'radial-gradient(circle, #eee 80%, #bbb 100%)';
                    circleGrad = 'linear-gradient(135deg,#eee 0%,#bbb 100%)';
                }
                // 1. 扩散主色圆环
                const ring = document.createElement('div');
                ring.style.position = 'fixed';
                ring.style.left = (cx - 1) + 'px';
                ring.style.top = (cy - 1) + 'px';
                ring.style.width = '2px';
                ring.style.height = '2px';
                ring.style.borderRadius = '50%';
                ring.style.boxSizing = 'border-box';
                ring.style.border = `6vw solid ${ringColor}`;
                ring.style.background = 'transparent';
                ring.style.zIndex = '-1';
                ring.style.transform = 'translate(-50%,-50%)';
                ring.style.transition = 'width 0.8s cubic-bezier(.4,2,.6,1), height 0.8s cubic-bezier(.4,2,.6,1), left 0.8s, top 0.8s, border-width 0.8s';
                greenBg.appendChild(ring);
                setTimeout(()=>{
                    ring.style.left = '50vw';
                    ring.style.top = '50vh';
                    ring.style.width = '300vw';
                    ring.style.height = '300vw';
                    ring.style.borderWidth = '0vw';
                }, 10);
                setTimeout(()=>{
                    greenBg.style.background = ringGrad;
                    ring.style.display = 'none';
                }, 500);

                // 2. 0.1秒后扩散副色色块
                setTimeout(()=>{
                    const circle2 = document.createElement('div');
                    circle2.style.position = 'fixed';
                    circle2.style.left = (cx - 1) + 'px';
                    circle2.style.top = (cy - 1) + 'px';
                    circle2.style.width = '2px';
                    circle2.style.height = '2px';
                    circle2.style.borderRadius = '50%';
                    circle2.style.background = circleColor;
                    circle2.style.zIndex = '-1';
                    circle2.style.transform = 'translate(-50%,-50%)';
                    circle2.style.transition = 'width 0.8s cubic-bezier(.4,2,.6,1), height 0.8s cubic-bezier(.4,2,.6,1), left 0.8s, top 0.8s, background 0.8s';
                    lightgreenBg.appendChild(circle2);
                    setTimeout(()=>{
                        circle2.style.left = '50vw';
                        circle2.style.top = '50vh';
                        circle2.style.width = '300vw';
                        circle2.style.height = '300vw';
                    }, 10);
                    setTimeout(()=>{
                        lightgreenBg.style.background = circleGrad;
                        circle2.style.display = 'none';
                    }, 900);
                }, 300);
            }

            // 卡片届期标题映射
            const sessionNames = ["2023", "2024", "敬请期待", "敬请期待", "敬请期待"];
            const flipTip = document.getElementById("flip-tip");

            document.addEventListener("click", (e) => {
                const centerCard = document.querySelector('.card.center');
                if (centerCard && centerCard.contains(e.target)) {
                    const idx = Array.from(cards).indexOf(centerCard);
                    const session = sessionNames[idx] || "X";
                    // 只在未翻转时才翻转
                    if (!centerCard.classList.contains("flipped")) {
                        centerCard.style.setProperty("--rotateX", "0deg");
                        centerCard.style.setProperty("--rotateY", "0deg");
                        centerCard.classList.add("flipped");
                        // 显示彩色标题
                        flipTip.innerHTML = `再次点击卡片进入<span style="font-size:2.1rem;vertical-align:-2px;">${session}</span>届页面。你的点击将为网页带来色彩。`;
                        setTimeout(()=>{
                            flipTip.style.display = "block";
                            flipTip.style.opacity = 1;
                        }, 500);
                    } else {
                        // 已翻转时
                        if (session === "敬请期待") {
                            // 不跳转也不扩散动画
                            return;
                        }
                        // 先播放扩散动画，动画结束后再跳转
                        playSessionExpand(centerCard, session);
                        setTimeout(() => {
                            window.location.href = `./info/info-page.html?set=${encodeURIComponent(session)}`;
                        }, 900);
                    }
                }
            });

            // 切换卡片时隐藏彩色标题
            function hideFlipTip() {
                flipTip.style.opacity = 0;
                setTimeout(()=>{flipTip.style.display = "none";}, 300);
            }
            prevBtn.addEventListener("click", hideFlipTip);
            nextBtn.addEventListener("click", hideFlipTip);
        });
    </script>
    <script>
    // 部门介绍按钮点击，通知父页面
    document.getElementById('btn-dep-intro')?.addEventListener('click', function(e) {
        e.preventDefault();
        window.parent.postMessage({ type: 'show-department-intro' }, '*');
    });
    </script>
 </body>
 </html>